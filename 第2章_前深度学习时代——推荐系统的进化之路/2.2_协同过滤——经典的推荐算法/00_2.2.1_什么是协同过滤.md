# 00_2.2.1 什么是协同过滤

"""
Lecture: 第2章 前深度学习时代——推荐系统的进化之路/2.2 协同过滤——经典的推荐算法
Content: 00_2.2.1 什么是协同过滤
"""

### 2.2.1 什么是协同过滤

#### 1. 协同过滤的概述
协同过滤（Collaborative Filtering，简称CF）是一种基于用户历史行为数据和其他用户评价数据进行推荐的方法。其基本思想是通过分析用户行为数据，找到相似用户或相似物品，然后根据这些相似用户或物品的评价数据进行推荐。协同过滤可以分为基于用户的协同过滤（UserCF）和基于物品的协同过滤（ItemCF）两大类。

#### 2. 协同过滤的基本思想和工作流程
协同过滤的核心思想是“物以类聚，人以群分”。它假设用户的行为模式存在一定的相似性，即相似的用户喜欢相似的物品，或者一个用户可能会喜欢与其之前喜欢的物品相似的其他物品。通过对大量用户的行为数据进行分析，可以找到这些相似性，并据此进行推荐。

##### 2.1 基本步骤
1. **数据收集**：收集用户对商品的历史评价数据，构建用户-商品矩阵（共现矩阵）。
2. **计算相似度**：计算用户或商品之间的相似度。
3. **预测评分**：根据相似度预测用户对未评分商品的可能评分。
4. **生成推荐列表**：根据预测评分生成推荐列表。

##### 2.2 具体流程
以图2-2为例，描述一个电商网站的协同过滤推荐过程，其步骤如下：

1. **商品库**：电商网站的商品库中共有4件商品：游戏机、小说、杂志和电视机。
2. **用户访问**：用户X访问该电商网站，网站需要决定是否推荐电视机给用户X。为此，需要预测用户X是否喜欢该品牌的电视机。可利用的数据包括用户X对其他商品的历史评价数据，以及其他用户对这些商品的历史评价数据。
3. **数据转换**：将用户和商品的评价记录转换成带有标识的有向图，以便于计算。点赞表示好评，踩表示差评。
4. **共现矩阵**：为便于计算，将有向图转换成共现矩阵，用户作为矩阵行坐标，商品作为列坐标，将点赞和踩的行为数据转换为矩阵中相应的元素值。点赞值为1，踩值为-1，没有数据时置为0。
5. **相似用户选择**：在共现矩阵中，根据行向量的相似度，选择与用户X最相似的Top n用户（例如n取2）。
6. **预测与推荐**：综合相似用户对电视机的评价，预测用户X对电视机的评价。如果相似用户的评价是负面的，则预测用户X对电视机的评价也是负面的。因此，不会向用户X推荐电视机。

#### 3. 用户相似度计算方法
在协同过滤的过程中，用户相似度的计算是算法中最关键的一步。计算用户之间的相似度可以有多种方法，常用的方法包括：

##### 3.1 余弦相似度（Cosine Similarity）
余弦相似度衡量的是两个用户向量之间的夹角。假设用户i和用户j的评分向量分别为 $\mathbf{R}_i$ 和 $\mathbf{R}_j$，则余弦相似度的计算公式为：
$$ \text{Sim}_{\text{cos}}(i,j) = \frac{\mathbf{R}_i \cdot \mathbf{R}_j}{\|\mathbf{R}_i\| \|\mathbf{R}_j\|} $$
其中，$\mathbf{R}_i \cdot \mathbf{R}_j$ 表示向量的点积，$\|\mathbf{R}_i\|$ 和 $\|\mathbf{R}_j\|$ 分别表示向量的模。

##### 3.2 皮尔逊相关系数（Pearson Correlation Coefficient）
皮尔逊相关系数通过考虑评分的平均值，减小了评分偏置的影响。假设用户i对物品p的评分为 $R_{i,p}$，用户i对所有物品的平均评分为 $\bar{R}_i$，则皮尔逊相关系数的计算公式为：
$$ \text{Sim}_{\text{pearson}}(i,j) = \frac{\sum_{p \in P} (R_{i,p} - \bar{R}_i)(R_{j,p} - \bar{R}_j)}{\sqrt{\sum_{p \in P} (R_{i,p} - \bar{R}_i)^2} \sqrt{\sum_{p \in P} (R_{j,p} - \bar{R}_j)^2}} $$
其中，P表示所有物品的集合。

##### 3.3 修正的余弦相似度
基于皮尔逊相关系数的思路，还可以通过引入物品平均分的方式，减少物品评分偏置对结果的影响。假设物品p的平均评分为 $\bar{R}_p$，则修正的余弦相似度计算公式为：
$$ \text{Sim}_{\text{adjusted cos}}(i,j) = \frac{\sum_{p \in P} (R_{i,p} - \bar{R}_p)(R_{j,p} - \bar{R}_p)}{\sqrt{\sum_{p \in P} (R_{i,p} - \bar{R}_p)^2} \sqrt{\sum_{p \in P} (R_{j,p} - \bar{R}_p)^2}} $$

#### 4. 结果的预测与排序
在获得Top n相似用户之后，可以通过加权平均法来预测目标用户对未评分物品的评分。具体公式如下：
$$ R_{u,p} = \frac{\sum_{s \in S} \text{Sim}(u,s) \cdot R_{s,p}}{\sum_{s \in S} |\text{Sim}(u,s)|} $$
其中，$S$ 表示相似用户集合，$\text{Sim}(u,s)$ 表示用户u和用户s之间的相似度，$R_{s,p}$ 表示用户s对物品p的评分。

根据预测评分对所有未评分物品进行排序，选取评分最高的前k个物品生成推荐列表。

#### 5. 协同过滤的优缺点分析
##### 5.1 优点
1. **直观性和可解释性**：协同过滤通过分析用户的历史行为数据进行推荐，符合人们的直觉。
2. **无需商品内容信息**：协同过滤只需要用户和商品的交互数据，不依赖商品的内容信息，因此适用于内容多样化、复杂度高的场景。

##### 5.2 缺点
1. **数据稀疏性**：用户的历史数据向量往往非常稀疏，对于只有几次购买或点击行为的用户，找到相似用户的准确度非常低。
2. **计算复杂度高**：在互联网应用场景下，用户数往往远大于商品数，协同过滤需要维护用户相似度矩阵，存储开销非常大，并且随着用户数的增加，计算复杂度以平方级别增长。

#### 6. 协同过滤的应用场景
协同过滤在多种场景下广泛应用，主要包括以下几个方面：

1. **电商网站**：例如Amazon，利用用户的购买历史记录进行商品推荐。
2. **视频推荐**：例如Netflix，利用用户的观影历史记录进行影片推荐。
3. **社交网络**：例如Facebook，通过分析用户的互动记录进行好友推荐。

#### 7. 协同过滤的改进方向
协同过滤模型在实际应用中面临许多挑战，如数据稀疏性、冷启动问题（对于新用户和新商品的数据不足）、计算复杂度高等。为了克服这些问题，许多改进方法被提出，包括：

1. **混合推荐模型**：结合协同过滤和基于内容的推荐模型，利用多种数据源提高推荐的准确性和覆盖率。
2. **矩阵分解技术**：利用矩阵分解技术，如奇异值分解（SVD）和非负矩阵分解（NMF），提高模型的泛化能力和计算效率。
3. **深度学习方法**：利用深度学习模型，如神经协同过滤（Neural Collaborative Filtering，NCF），提高模型的非线性表达能力和推荐效果。

通过上述改进方法，可以在一定程度上解决协同过滤的缺点，提高推荐系统的性能和用户体验。

---
