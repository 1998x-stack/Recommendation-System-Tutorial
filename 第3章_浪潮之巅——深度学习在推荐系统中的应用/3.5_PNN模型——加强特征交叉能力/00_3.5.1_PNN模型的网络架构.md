# 00_3.5.1 PNN模型的网络架构

"""
Lecture: 第3章 浪潮之巅——深度学习在推荐系统中的应用/3.5 PNN模型——加强特征交叉能力
Content: 00_3.5.1 PNN模型的网络架构
"""

### PNN模型的网络架构

#### 一、引言

PNN（Product-based Neural Network）模型是上海交通大学的研究人员于2016年提出的，旨在解决CTR（Click-Through Rate）预估和推荐系统中的特征交叉问题。PNN模型通过引入乘积层（Product Layer），有效地捕捉了不同特征之间的交叉信息。以下将详细分析PNN模型的网络架构。

#### 二、PNN模型的网络架构

##### 1. 输入层和Embedding层

**1.1 输入层：**
- 输入层包括用户ID、物品ID以及其他可能的辅助特征（如上下文信息等）。这些输入特征通常是类别型特征，需要通过Embedding层进行稠密化处理。

**1.2 Embedding层：**
- 将类别型特征转换为稠密的低维向量，即Embedding向量。每个类别型特征都有一个独立的Embedding矩阵，将类别ID映射到稠密向量。

##### 2. 乘积层（Product Layer）

**2.1 乘积层的定义：**
- 乘积层是PNN模型的核心创新部分，用于捕捉特征之间的交叉信息。乘积层包括内积操作和外积操作，分别生成内积向量和外积矩阵。

**2.2 内积操作：**
- 内积操作计算特征向量之间的内积，生成一个新的向量。假设特征向量为$\mathbf{f}_i$和$\mathbf{f}_j$，内积操作定义为：$$ g_{\text{inner}}(\mathbf{f}_i, \mathbf{f}_j) = \mathbf{f}_i \cdot \mathbf{f}_j $$

**2.3 外积操作：**
- 外积操作计算特征向量之间的外积，生成一个新的矩阵。假设特征向量为$\mathbf{f}_i$和$\mathbf{f}_j$，外积操作定义为：$$ g_{\text{outer}}(\mathbf{f}_i, \mathbf{f}_j) = \mathbf{f}_i \otimes \mathbf{f}_j $$

**2.4 降维处理：**
- 为了减小外积操作带来的计算复杂度，PNN模型对外积结果进行了降维处理，将所有两两特征向量的外积结果叠加形成一个叠加外积向量。

##### 3. 隐藏层

**3.1 全连接层：**
- 乘积层的输出向量和原始特征向量一起输入到全连接层。全连接层由多层神经网络组成，每层神经网络由线性变换和非线性激活函数（如ReLU）组成。

**3.2 局部全连接层：**
- 在乘积层内部，PNN模型对内积和外积结果进行了局部全连接层的转换，将内积部分$\mathbf{z}$和外积部分$\mathbf{p}$映射成新的向量$\mathbf{l}_z$和$\mathbf{l}_p$，然后将$\mathbf{l}_z$和$\mathbf{l}_p$叠加输入到隐藏层。

##### 4. 输出层

**4.1 预测层：**
- 最后的输出层用于预测用户对物品的点击率或评分。输出层通常使用Sigmoid函数，将输出值映射到[0,1]区间内，表示预测的点击概率。

**4.2 损失函数：**
- 对于点击率预估任务，常用的损失函数是交叉熵损失函数。对于评分预测任务，常用的损失函数是均方误差（MSE）损失函数。

#### 三、PNN模型的应用实例

**3.1 CTR预估：**
- 在广告推荐中，PNN模型可以用于预估用户对广告的点击率。通过捕捉用户和广告特征之间的交叉信息，提高了点击率预估的准确性。

**3.2 推荐系统：**
- 在推荐系统中，PNN模型可以用于预测用户对商品的评分或点击概率，提供个性化推荐服务。

#### 四、总结

PNN模型通过引入乘积层，有效地捕捉了不同特征之间的交叉信息，增强了模型的表达能力。其创新的内积和外积操作，使得PNN模型在CTR预估和推荐系统中表现出色。尽管PNN模型在特征交叉上具有优势，但在计算复杂度上需要进行合理的降维处理，以保证模型的训练效率。
