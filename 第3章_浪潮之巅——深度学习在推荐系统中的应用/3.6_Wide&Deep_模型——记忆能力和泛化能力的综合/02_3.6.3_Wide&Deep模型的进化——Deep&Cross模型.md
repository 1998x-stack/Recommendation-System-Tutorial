# 02_3.6.3 Wide&Deep模型的进化——Deep&Cross模型

"""
Lecture: 第3章 浪潮之巅——深度学习在推荐系统中的应用/3.6 Wide&Deep 模型——记忆能力和泛化能力的综合
Content: 02_3.6.3 Wide&Deep模型的进化——Deep&Cross模型
"""

### Wide & Deep模型的进化——Deep & Cross模型

#### 一、引言

Wide & Deep模型结合了简单模型的记忆能力和深度神经网络的泛化能力，极大提升了推荐系统的性能。然而，Wide & Deep模型仍存在一些不足之处，比如对特征交叉的处理不够灵活。为了解决这些问题，斯坦福大学和谷歌的研究人员于2017年提出了Deep & Cross模型（Deep & Cross Network, DCN），旨在通过引入Cross网络增强特征交互能力，从而进一步提升推荐系统的性能。

#### 二、Deep & Cross模型的结构

Deep & Cross模型的基本结构如图3-15所示。DCN模型主要由两部分组成：Cross网络和Deep网络。

##### 1. Cross网络

Cross网络的设计目的是增加特征之间的交互强度。与Wide & Deep模型中的Wide部分不同，Cross网络通过多层交叉层（Cross layer）对输入向量进行特征交叉。假设第 $ l $ 层交叉层的输出向量为 $ x_l $，那么第 $ l+1 $ 层的输出向量可以表示为：
$$ x_{l+1} = x_0 \cdot (w_l^T x_l) + b_l + x_l $$
其中，$ w_l $ 是权重向量，$ b_l $ 是偏置向量，$ x_0 $ 是原始输入向量。

通过这种方式，交叉层能够有效捕捉特征之间的二阶交互信息，类似于PNN模型中的外积操作。每一层交叉层仅增加了一个 $ n $ 维的权重向量 $ w_l $（ $ n $ 为输入向量的维度），并且每一层均保留了输入向量，因此输出与输入之间的变化不会特别明显。

##### 2. Deep网络

Deep网络部分的设计思路没有本质变化，依然是通过Embedding层将类别型特征转换为稠密向量，然后通过多层全连接层（Fully Connected Layer）进行特征处理。Deep网络的主要作用是对特征进行深度挖掘，捕捉特征之间的高阶非线性关系。

##### 3. 输出层

Cross网络和Deep网络的输出会在最终的输出层进行结合，通过逻辑回归层进行目标拟合。通过这种方式，DCN模型能够同时利用记忆能力和泛化能力，既能快速响应用户的历史行为，又能准确推荐新物品。

#### 三、Cross网络的设计和实现

Cross网络的核心在于交叉层的设计。交叉层的操作如图3-16所示。每一层交叉层的输入为 $ x_l $，输出为 $ x_{l+1} $。具体操作如下：

1. **二阶交叉操作**：计算输入向量 $ x_l $ 和原始输入向量 $ x_0 $ 的二阶交互信息，即 $ x_0 \cdot (w_l^T x_l) $。
2. **加权求和**：将二阶交互信息与偏置向量 $ b_l $ 和输入向量 $ x_l $ 相加，得到输出向量 $ x_{l+1} $。

这种设计能够有效增加特征之间的交互强度，捕捉特征之间的复杂关系。

#### 四、Deep & Cross模型的优势

1. **增强的特征交互能力**：通过引入Cross网络，DCN模型能够更有效地捕捉特征之间的复杂交互关系，提高推荐系统的准确性。
2. **端到端训练**：DCN模型采用端到端的训练方式，使模型能够自动学习到最优的特征交叉方式和参数设置，避免了繁琐的人工特征工程。
3. **计算复杂度相对较低**：虽然引入了交叉层，但每一层仅增加一个 $ n $ 维的权重向量，因此计算复杂度相对较低，模型训练效率较高。

#### 五、总结

Deep & Cross模型通过引入Cross网络，有效增强了特征交互能力，结合了Wide & Deep模型的记忆能力和泛化能力，进一步提升了推荐系统的性能。DCN模型的提出不仅解决了Wide & Deep模型的一些不足，还为后续的推荐系统模型设计提供了新的思路。在实际应用中，DCN模型凭借其强大的特征交互能力和高效的计算性能，已被广泛应用于各类推荐系统中，成为业界主流模型之一   。

---


### Deep & Cross模型的结构

#### 一、引言

Deep & Cross模型（DCN）是Wide & Deep模型的进化版本，由斯坦福大学和谷歌的研究人员于2017年提出。该模型通过引入Cross网络来增强特征交互能力，从而提高推荐系统的性能。DCN模型主要由两个部分组成：Cross网络和Deep网络。

#### 二、DCN模型的结构

##### 1. Cross网络

Cross网络的设计目的是增加特征之间的交互强度。与Wide & Deep模型中的Wide部分不同，Cross网络通过多层交叉层（Cross layer）对输入向量进行特征交叉。每一层交叉层的操作如下：

1.1. **Cross网络的基本操作**：
假设第 $ l $ 层交叉层的输出向量为 $ x_l $，那么第 $ l+1 $ 层的输出向量可以表示为：
$$ x_{l+1} = x_0 \cdot (w_l^T x_l) + b_l + x_l $$
其中，$ w_l $ 是权重向量，$ b_l $ 是偏置向量，$ x_0 $ 是原始输入向量。

1.2. **操作详解**：
- **二阶交叉操作**：计算输入向量 $ x_l $ 和原始输入向量 $ x_0 $ 的二阶交互信息，即 $ x_0 \cdot (w_l^T x_l) $。
- **加权求和**：将二阶交互信息与偏置向量 $ b_l $ 和输入向量 $ x_l $ 相加，得到输出向量 $ x_{l+1} $。

通过这种方式，交叉层能够有效捕捉特征之间的二阶交互信息，类似于PNN模型中的外积操作。每一层交叉层仅增加了一个 $ n $ 维的权重向量 $ w_l $（ $ n $ 为输入向量的维度），并且每一层均保留了输入向量，因此输出与输入之间的变化不会特别明显。

1.3. **Cross网络示意图**：
![Cross网络示意图](https://raw.githubusercontent.com/jiachen0212/images/main/dcn_cross.png)

##### 2. Deep网络

Deep网络部分的设计思路没有本质变化，依然是通过Embedding层将类别型特征转换为稠密向量，然后通过多层全连接层（Fully Connected Layer）进行特征处理。Deep网络的主要作用是对特征进行深度挖掘，捕捉特征之间的高阶非线性关系。

2.1. **Embedding层**：
- **类别型特征转换**：Embedding层将类别型特征（如用户ID、商品ID等）转换为稠密向量。
- **特征组合**：通过多层全连接层对Embedding向量进行组合，挖掘特征之间的高阶非线性关系。

2.2. **多层全连接层（Dense Layers）**：
- **激活函数**：全连接层通常使用ReLU（Rectified Linear Unit）激活函数，以增强模型的非线性表达能力。
- **特征交叉**：通过多层全连接层对特征进行深度交叉和处理，捕捉特征背后的数据模式。

2.3. **Deep网络示意图**：
![Deep网络示意图](https://raw.githubusercontent.com/jiachen0212/images/main/dcn_deep.png)

##### 3. 输出层

Cross网络和Deep网络的输出会在最终的输出层进行结合，通过逻辑回归层进行目标拟合。具体而言，Cross网络的输出和Deep网络的输出会被拼接起来，作为最终输出层的输入，进行最终的预测。通过这种方式，DCN模型能够同时利用记忆能力和泛化能力，既能快速响应用户的历史行为，又能准确推荐新物品。

3.1. **输出层示意图**：
![输出层示意图](https://raw.githubusercontent.com/jiachen0212/images/main/dcn_output.png)

#### 三、DCN模型的优势

1. **增强的特征交互能力**：
通过引入Cross网络，DCN模型能够更有效地捕捉特征之间的复杂交互关系，提高推荐系统的准确性。

2. **端到端训练**：
DCN模型采用端到端的训练方式，使模型能够自动学习到最优的特征交叉方式和参数设置，避免了繁琐的人工特征工程。

3. **计算复杂度相对较低**：
虽然引入了交叉层，但每一层仅增加一个 $ n $ 维的权重向量，因此计算复杂度相对较低，模型训练效率较高。

#### 四、总结

Deep & Cross模型通过引入Cross网络，有效增强了特征交互能力，结合了Wide & Deep模型的记忆能力和泛化能力，进一步提升了推荐系统的性能。DCN模型的提出不仅解决了Wide & Deep模型的一些不足，还为后续的推荐系统模型设计提供了新的思路。在实际应用中，DCN模型凭借其强大的特征交互能力和高效的计算性能，已被广泛应用于各类推荐系统中，成为业界主流模型之一。