# 02_8.2.3 基于长期兴趣的用户Embedding和房源Embedding

"""
Lecture: 第8章 深度学习推荐系统的前沿实践/8.2 Airbnb基于Embedding的实时搜索推荐系统
Content: 02_8.2.3 基于长期兴趣的用户Embedding和房源Embedding
"""

### 8.2.3 基于长期兴趣的用户Embedding和房源Embedding

#### 引言
在Airbnb的推荐系统中，除了捕捉用户的短期兴趣，还需要考虑用户的长期兴趣。这些长期兴趣通常包含用户在过去预订过的房源信息，从而能够反映用户对房屋价格、房屋类型等属性的偏好。通过构建基于长期兴趣的用户Embedding和房源Embedding，可以在最终的推荐结果中更好地满足用户的长期偏好。

#### 用户长期兴趣的捕捉
1. **预订会话序列**：
   - **定义**：预订会话序列（booking session sequence）指的是用户在一段时间内预订的房源序列。举例来说，用户在过去1年内依次预订了5个房源，那么其预订会话序列就是：$ s_j = (l_{j1}, l_{j2}, l_{j3}, l_{j4}, l_{j5}) $。
   - **目的**：通过捕捉用户的预订会话序列，可以获得用户的长期兴趣信息，这些信息在传统的基于点击数据的短期兴趣模型中是缺失的。

#### 数据稀疏问题
在实际应用中，预订会话序列存在数据稀疏问题，这主要表现在以下几个方面：
1. **预订行为的总体数量少于点击行为**：预订行为相对于点击行为而言，数量要少得多，导致预订会话序列的规模远小于点击会话。
2. **单一用户的预订行为较少**：许多用户在过去一年中可能只预订过一个房源，这使得预订会话序列的长度往往很短。
3. **房源的预订次数少**：大部分房源的预订次数较少，无法满足Word2vec模型训练所需的最低出现次数，从而难以生成有效的Embedding。

#### 解决数据稀疏问题的方法
为了解决数据稀疏问题，Airbnb采用了基于属性规则的相似用户和相似房源聚合方法：
1. **房源属性标识**：通过房源的属性名称和分桶ID（例如国家、类型、价格范围等）组成房源属性标识。例如，一个房源的属性标识可以是US_lt1_pn3，表示该房源位于美国（US）、类型是娱乐（lt1）、价格范围是56-59美元（pn3）。
2. **用户属性标识**：用户属性包括设备类型、是否填写简介、是否有头像照片、历史预订次数等，通过与房源属性类似的方法生成用户属性标识（user type）。
3. **预订序列生成**：利用用户属性替代原来的user id，生成一个由所有该用户属性预订历史组成的预订序列。这种方法有效解决了用户预订数据稀疏的问题。

#### 用户Embedding和房源Embedding的生成
1. **定义Embedding目标函数**：将用户属性和房源属性置于同一个向量空间中。训练过程中，用户属性和房源属性被同等对待。具体的Embedding目标函数沿用Word2vec的目标函数，通过负采样方法进行训练。
2. **Embedding训练**：在训练过程中，通过滑动窗口技术，将用户属性和房源属性作为词对进行训练。最终得到的用户和房源Embedding向量可以在同一向量空间中进行相似度计算，从而反映用户对某房源的长期兴趣偏好。

#### 冷启动问题的解决
1. **相似房源平均**：对于新的房源，由于缺乏足够的预订数据，无法生成有效的Embedding。Airbnb采用相似房源平均的方法，通过找到附近的3个同类型、相似价格的房源向量进行平均，生成新的Embedding向量。

#### 总结
Airbnb通过构建基于长期兴趣的用户Embedding和房源Embedding，有效捕捉用户的长期兴趣信息，解决了数据稀疏和冷启动问题，提高了推荐系统的准确性和个性化水平。该方法的成功应用展示了深度学习在推荐系统中的强大潜力，为其他推荐系统的开发提供了宝贵的经验和参考。

---